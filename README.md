# dev-email-server
Это конечно далеко не идеальная реализация docker контейнера с email-сервером и
сопутствующими сервисами, но мне она очень помогает в процессе разработки различного
ПО, которое отсылает или получает email-сообщения различным адресатам.

Довольно часто при разработке такого ПО нужно проверить какие именно email
отсылаются и получаются (адреса отправителя и получателя, заголовки и тело письма).
При этом далеко не всегда удобно использовать на время тестов "подставные" тестовые
email-адреса и какие-то "внешние сервисы". Также, бывает необходимо проверить
сам протокол обмена данными в процессе отправки и получения email-сообщений.

Для облегчения этой задачи я собрал для себя набор сервисов, которые упаковал в
docker-образ, чтобы любой желающий мог скачать и запустить его в себя на компьютере.

Основная особенность данного набора то, что он позволяет отправлять и получать
email для абсолютно любых адресов, например, вы можете отправить письмо
(через smtp/smtps) с адреса mail1@company1.com на адрес mail2@company2.com, а потом
подключиться к почтовому ящику (через imap/imaps/pop3d/pop3ds) mail2@company2.com
и прочитать это письмо со всеми заголовками.

Для тестирования обработки писем, которые небыли доставлены настроен (можно изменить)
домен bad-domain.com. Письма на любой адрес этого домена будут возвращаться, как
недоставленные (через некоторое время).

Для аутентификации на сервисах всегда в качестве логина используется полный
email-адрес, в качестве логина, и часть адреса до символа @, в качестве пароля.

При настройке отправки email через smtp/smtps нужно обязательно использовать
авторизацию по логину и паролю (с использованием ssl/tls или нет неважно),
т.к. возможность пересылки сообщений (relay) на любой адрес включена только если
отправитель аутентифицирован.

Образ содержит в себе:

* smtp (порт 25) и smtps (порт 465) сервер для отправки сообщений
* imap (порт 143) и imaps (порт 993) сервер для доступа к почтовым ящикам по протоколу imap
* pop3d (порт 110) и pop3ds (порт 995) сервер для доступа к почтовым ящикам по протоколу pop3d
* http (порт 80) и https (порт 443) сервер для доступа к почтовым ящикам через web gui

Для доступа через ssl/tls используется самоподписанный сертификат ssl для url
mail.localhost, который находится в каталоге `/etc/dovecot/private` (docker volume)
```
-rw-rw-r-- 1 mail.localhost.crt.pem
-rw------- 1 mail.localhost.key.pem
```
Чтобы этот сертификат не менялся в результате пересборки образа docker или для
замены его собственным сертификатом, рекомендуется использовать docker volume.


Для запуска контейнера с образом докер можно использовать команду
```
docker run -d --name dev-email-server \
    -p 127.0.0.1:25:25/tcp -p 127.0.0.1:465:465/tcp \
    -p 127.0.0.1:143:143/tcp -p 127.0.0.1:993:993/tcp \
    -p 127.0.0.1:110:110/tcp -p 127.0.0.1:995:995/tcp \
    -p 127.0.0.1:80:80/tcp -p 127.0.0.1:443:443/tcp \
    -v dev-email-server-cert:/etc/dovecot/private \
    -v dev-email-server-mail:/var/mail \
    test:latest
```
Если текущий пользователь не имеет прав для запуска docker (не включен в группу docker),
то нужно добавить вначале `sudo`.
